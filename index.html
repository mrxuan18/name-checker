<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>校友礼品领取系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #002FA7; /* 克莱因蓝 (International Klein Blue) */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 30px;
        }
        
        .loading-container {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 12px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
        }
        
        .loading-text {
            font-size: 14px;
            color: #007bff;
            margin-bottom: 10px;
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .sync-status {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #99d5ff;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 12px;
        }
        
        .cloud-badge {
            background: #002FA7; /* 克莱因蓝 */
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 11px;
            margin-bottom: 15px;
            display: inline-block;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        .name-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .name-input:focus {
            border-color: #002FA7; /* 克莱因蓝 */
            box-shadow: 0 0 0 3px rgba(0, 47, 167, 0.1);
        }
        
        .name-input:disabled {
            background: #f8f9fa;
            color: #6c757d;
        }
        
        .check-btn {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            background: #002FA7; /* 克莱因蓝 */
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .check-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 47, 167, 0.3);
        }
        
        .check-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result {
            padding: 20px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 20px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            white-space: pre-line; /* 保留换行符 */
            line-height: 1.5;
        }
        
        .result.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .result.available {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .result.taken {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }
        
        .result.not-found {
            background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
            color: white;
        }
        
        .duplicate-options {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }
        
        .duplicate-title {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .duplicate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .duplicate-item:last-child {
            border-bottom: none;
        }
        
        .duplicate-name {
            font-weight: bold;
            color: #333;
        }
        
        .duplicate-status {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
        }
        
        .status-available {
            background: #d4edda;
            color: #155724;
        }
        
        .status-taken {
            background: #f8d7da;
            color: #721c24;
        }
        
        .duplicate-btn {
            padding: 6px 12px;
            font-size: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #002FA7; /* 克莱因蓝 */
            color: white;
        }
        
        .duplicate-btn:hover {
            background: #0026a7; /* 稍微深一点的克莱因蓝 */
        }
        
        .duplicate-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #002FA7; /* 克莱因蓝 */
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
        }
        
        .action-btn {
            padding: 10px 8px;
            font-size: 13px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .action-btn:hover {
            background: #f8f9fa;
        }
        
        .refresh-btn {
            border-color: #28a745;
            color: #28a745;
        }
        
        .refresh-btn:hover {
            background: #28a745;
            color: white;
        }
        
        .export-btn {
            border-color: #4facfe;
            color: #4facfe;
        }
        
        .info-btn {
            border-color: #17a2b8;
            color: #17a2b8;
        }
        
        .info-btn:hover {
            background: #17a2b8;
            color: white;
        }
        
        .animation {
            animation: fadeInUp 0.5s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .hidden {
            display: none;
        }
        
        /* 微信适配 */
        @media screen and (max-width: 480px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .title {
                font-size: 20px;
            }
            
            .name-input, .check-btn {
                font-size: 16px;
                padding: 12px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container animation">
        <h1 class="title">🎁 校友礼品领取系统</h1>
        <p class="subtitle">输入您的姓名查询礼品领取状态</p>
        
        <div class="cloud-badge">⚡ JSONBin云同步驱动</div>
        
        <!-- 加载状态 -->
        <div class="loading-container" id="loadingContainer">
            <div class="loading-text" id="loadingText">正在加载校友名单...</div>
            <div class="loading-spinner" id="loadingSpinner"></div>
        </div>
        
        <!-- 同步状态 -->
        <div class="sync-status hidden" id="syncStatus">数据已全球同步</div>
        
        <!-- 错误信息 -->
        <div class="error-message hidden" id="errorMessage"></div>
        
        <!-- 成功信息 -->
        <div class="success-message hidden" id="successMessage"></div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="claimedCount">-</div>
                <div class="stat-label">已领取人数</div>
            </div>
        </div>
        
        <div class="input-group">
            <input type="text" class="name-input" id="nameInput" placeholder="请输入您的姓名..." maxlength="20" disabled>
        </div>
        
        <button class="check-btn" id="checkBtn" disabled>查询领取状态</button>
        
        <!-- 重名选择区域 -->
        <div class="duplicate-options" id="duplicateOptions">
            <div class="duplicate-title">检测到重名，请选择您的信息：</div>
            <div id="duplicateList"></div>
        </div>
        
        <div class="result" id="result"></div>
        
        <div class="actions">
            <button class="action-btn refresh-btn" onclick="refreshData()">刷新数据</button>
            <button class="action-btn export-btn" onclick="exportData()">导出记录</button>
            <button class="action-btn info-btn" onclick="showJsonBinInfo()">云端管理</button>
        </div>
    </div>

    <script>
        // JSONBin.io 配置 - 已配置完成
        const CONFIG = {
            // JSONBin.io 配置
            jsonbinApiKey: '$2a$10$0lpY8yCa3Wf4T7L1kEtOdee9wXfNo16Im07YCEYC7igwp4ujFPLoy',  // 你的 API Key
            jsonbinBinId: '6837d66a8561e97a501ce5c7',     // 你的 Bin ID
            useCloudSync: true,                           // 启用云同步
            
            // GitHub CSV 配置
            githubUser: 'mrxuan18',                       // 你的GitHub用户名
            repoName: 'name-checker',                     // 你的仓库名
            csvFileName: 'alumni.csv',                    // CSV文件名
            useGitHubCSV: true,                          // 从GitHub加载校友名单
            
            // 备用校友名单（如果GitHub加载失败时使用）
            embeddedCSV: `张三
姓名
阿丽米拉
阿丽米拉·艾尼瓦尔
艾莉
安生璟
敖文钱
敖翔
白浩楠
白熙
白雨凡
白钰
白悦涵
柏涛
班瑜璐
包建华
包琦
蔡春
蔡璐遥
蔡舒羽
蔡双双
蔡兴瑜
蔡学华
曹海天
曹楠
曹世聪
曹维
曹文雨
曹夏伟
曹莹莹
曾安莱
曾丽娟
曾莉
曾敏
曾澎
曾茹燕
曾汶婷
曾心杨
曾雪
曾亦林
曾雨佳
曾月
曾昭旭
曾正洲
曾卓文
曾子芙
查玉辉
柴雯春
常生智
车越
陈彬慈
陈畅
陈琛
陈春江
陈春生
陈翠
陈德强
陈晗琦
陈宏韬
陈鸿博
陈欢
陈嘉港
陈锦
陈锦华
陈隽
陈恺悦
陈科任
陈黎
陈丽霖
陈栎元
陈茂钰
陈铭
陈平争
陈琦
陈芮喆
陈瑞莱
陈姝灵
陈思岐
陈思宇
陈思源
陈维
陈伟军
陈文华
陈雯
陈熹
陈翔宇
陈向红
陈小萍
陈晓雨
陈心琪
陈雪晴
陈娅琦
陈阳
陈旸
陈一凡
陈钇频
陈寅
陈英
陈永辉
陈渝
陈羽桃
陈语悦
陈昱帆
陈袁媛
陈苑红
陈韵竹
陈泽玮
陈稚柔
陈卓
陈子雄
成相天
程滨
程常富
程金熙
程可名
程思宁
程晓珺
程雅雯
程之曦
仇怡欣
储玲
楚鸣明
丛雪蕾
崔留辉
崔梦珅
崔晴晴
崔舒箫
崔媛
寸冬菊
寸乐玲
代晨航
代秋昳
代少兵
代维
代祥和
戴冰雨
戴虹
戴晶晶
戴雨栖
戴钰珂
戴蕴之
但礼嘉
党若愚
邓代华
邓国君
邓航
邓纪庭
邓金龙
邓丽平
邓琳
邓梦佳
邓倩
邓甦灏
邓韬凌
邓婷
邓维斯 
邓文瑞
邓骁
邓以宬
邓泽亨
邓泽亨
邓长江
邓桢干
刁慧宁
丁凯旋
董犇
董喊
董一
董越
董震
杜海涛
杜佳
杜绍雄
杜修铀
杜宇
杜宇超
杜自明
段浩然
段康
段林宏
段棋朦
段雪婷
段亚冬
段玉兰
樊豆
樊浩玲
樊靖瑶
范丰艺
范绍印
范诗玮
范天伟
范天伟
范小菲
范艳华
范至立
方牧野
方萍
方西陆
费青
费旋
费璇
封明磊
冯驰
冯春梅
冯建
冯婉晶
冯雯
冯彦琪
冯子玉
符洁
付梦曦
付敏
付思翰
付薇
付薇
付伟
付孝磊
付颖
傅成杰
傅驰
傅代国
傅丽
傅宇恒
傅禹
甘福荣
甘梦妮
甘甜
甘源
高博川
高健
高静
高孟媛
高孟媛
高倩云
高上雅
高斯语
高献淞
高宇辰
高玉庭
高源
高媛
葛思妤
耿桂玉
龚嫒嫒
苟家欣
辜志强
谷峰
谷檬
谷雨洁
顾杰
顾金梅
关畅
官芝颖
桂灵
郭冰欣
郭晟
郭鉴德
郭景翀
郭林林
郭倩玉
郭润生
郭修琦
郭雅丹
郭一铭
韩冰
韩海明
韩杰
韩懋睿
韩雪涛
郝鹏
何凤丹
何鸿荣
何会平
何济廷
何佳应
何力
何力
何丽
何柳明
何明
何权
何若霜
何珊
何珊 
何田
何馨月
何雨
何雨涵
何雨婷
何雨馨
何玉婷
何梓溪
何自军
贺堃
贺苓
洪丽丽
洪天云
侯富华
侯瑞林
侯彦芬
胡曾静
胡丹婷
胡佳
胡家维
胡俊杰
胡凌云
胡其鑫
胡睿
胡睿
胡珊珊
胡晓宇
胡旭光
胡瑶瑶
胡莹
胡宇妍
胡争
花语剑
黄伯仙
黄粲
黄超
黄承浩
黄川渝
黄丹妮
黄德胜
黄昊男
黄合
黄恒
黄佼琪
黄杰
黄金雷
黄娟
黄蕾
黄铃琅
黄敏
黄然
黄少莹
黄绍凯
黄诗程
黄书博
黄苏丽
黄涛
黄婉
黄韦铭
黄维坚
黄小朵
黄晓芸
黄昕
黄尧
黄耀东
黄译葭
黄羽茜
黄媛
黄哲一
黄治棉
黄子敖
黄子瑄
黄子洢
惠云燕
霍孟培
霍晓旭
计子心
纪艾霖
贾攀
贾茹麟
贾世宏
贾子晴
简杨扬
江昊杭
江家磊
江坤桦
江丽君
江灵曼
江凌飞
江小红
江瑛婕
姜冰冰
姜佳文
姜珊 
姜欣慰
姜勇先
姜子扬
蒋金燕
蒋胜煌
蒋文洁
蒋亚男
蒋怡
蒋英
蒋雨辛
蒋宗儒
焦慧
焦薇
焦文昊
解星晨
金桐立
金晓奇
金泽宇
敬若兰
敬子霄
康光文
康瀚月
康越
孔璐
孔彦辉
孔艺霖
库提比亚·凯赛尔
邝雨奚
赖思敏
赖宣慧
兰斓
乐舒晴
乐树标
雷洪云
雷君
雷蕾
雷鹏
雷乾巍
雷淑玲
雷杨
雷雨杭
冷洲
黎健祥
黎芸
李百玄
李碧莹
李彬毓
李斌
李波 
李伯红
李晨洋
李晨毓
李春
李春燕
李旦
李东娜
李冬
李方泽
李芳娟
李飞
李好
李宏毓
李佳
李佳明
李佳宁
李佳伟
李佳洋
李佳颖
李佳赟
李嘉诚
李嘉薇
李嘉苇
李娇萱
李杰
李金晨
李劲
李婧超
李静
李珏松
李军达
李骏
李可欣
李坤洁
李昆奇
李琳琳
李露怡
李洛嘉
李梦冉
李明智
李攀
李霈晴
李萍
李泊霖
李祺言
李倩
李强
李琴
李秋函
李荣华
李芮
李芮
李润圣
李若涵
李盛勇
李诗瑶
李思涵
李思敏
李思琪
李甜甜
李廷
李韦萱
李霞
李霄
李小娇
李小静
李小林
李晓玲
李晓媛
李心怡
李欣喻
李鑫婷
李鑫宇
李星睿
李雪飞
李雪梅
李娅
李一博
李一非
李漪菲
李怡君
李屹人
李亦可
李逸鸥
李寅斌
李泳谊
李雨昕
李雨轩
李玉菊
李钰煊
李玥
李越琦
李泽玥
李湛
李长蔚
李哲斌
李振显
李峥
李正一
李之翼
李智
李卓莹
李卓远
李梓旭
李梓萱
栗宇丹
连轶
梁浩
梁磊
梁璐
梁攀
梁青青
梁霞
梁旭东
梁颖璐
梁涌
梁雨昕
廖成赟
廖帝源
廖多灵
廖乾宏
廖潇玙
廖萱
廖延旭
廖资健
林碧
林宏
林洪梅
林晋永
林可欣
林琳
林璐冰
林松
林文
林显锋
林友敬
刘超
刘楚岩
刘德春
刘德银
刘冬梅
刘冬寅
刘梵宇
刘凤婷
刘罡
刘光怡
刘瀚枫
刘洪珍
刘鸿至
刘辉
刘佳玲
刘佳铭
刘嘉琦
刘建群
刘瑾洁
刘静
刘轲珂
刘来清
刘力歌
刘力子
刘利
刘凌霜
刘璐
刘鹏飞
刘启霞
刘千芊
刘倩
刘钦婷
刘清清
刘润帮
刘珊珊
刘诗寒
刘思敏
刘思扬
刘思瑶
刘婷婷
刘彤彤
刘维
刘维
刘为民
刘魏
刘文思
刘贤
刘相君
刘祥根
刘翔
刘小洁
刘小雪
刘晓梅
刘心
刘心宇
刘心悦
刘欣怡
刘欣雨
刘馨竹
刘星雨
刘兴懿
刘亚男
刘亚琪
刘耀
刘耀东
刘一博
刘一静
刘一麟
刘艺佳
刘英
刘宇航
刘雨
刘雨河
刘雨薇
刘雨箫
刘雨昕
刘玉洁
刘玉勋
刘钰岑
刘媛
刘媛媛
刘长穗
刘滋雨
柳泊逸
柳星雅
龙和翔
龙慧琳
龙敏玲
龙婉超
龙文韬
龙星星
龙星亦
龙亚琴
卢涵文
卢倩
鲁品
鲁雅晴
陆澜之
陆旭
陆远志
陆正定
路璐
罗艾奇
罗彪
罗超盛
罗华伟
罗佳宇
罗嘉南
罗世娇
罗松
罗为
罗文
罗希
罗鑫
罗杨
罗艺湘
罗颖
罗永奇
罗玉莲
罗圆圆
罗泽
罗正英
罗智莉
罗紫嫣
骆春艳
骆钢
骆浩楠
骆泳宏
吕函遥
吕慧勤
吕庆兰
吕先锫
吕英
马•阿伊莎
马晨刚
马华敏
马佳敏
马静惠
马克
马千里
马青云
马庆
马圣一
马文迪
马潇
马晓彬
马晓天
马彦薇
马一汀
马越
马云锋
马泽龙
马桢
马仲卓
毛斌雯
毛晨煜
毛婷
梅永杰
蒙义龙
蒙颖 
孟丽娜
孟祥婷
孟小愚
孟子靖
米晨璐
米薪宇
苗晨
苗芃
苗芃
闵春蓓
闵振为
明酿
莫思慧
牟凌彤
缪飞翔
尼玛登珠
倪溪梅
倪献
聂可翔
宁伊婷
牛菁怡
欧万春
欧阳爱琳
欧阳欢
欧阳玲
欧阳暮秋
潘嗣芬
潘翔鸣
潘学模
潘奕安
盘彦希
庞钰之
裴佳欣
彭必文
彭岱威
彭岚
彭辽
彭路斯
彭邱露
彭诗语
彭曦阳
彭雄豪
蒲晨曦
蒲荣森
蒲天渡
戚甘雨
齐琪
齐熠
钱俊翰
乔欢
秦莅昌
秦婷
秦宇
秦宇
秦竹林
邱冠棕
邱天孝
邱小林
邱亚男
邱宇
邱宗烨
曲若晨
曲太峰
屈子棠
冉婧莹
冉茂娟
冉宁果
冉婷婷
冉晓林
冉奕璐
冉煜新
冉子扬
饶明强
饶筱涵
任聪
任德明
任芳
任敏
任鸣啼
任培康
任巧丽
任清清
任小丽
任晓莉
任新新
任远奕
荣红
阮永娟
尚佳
尚鹏飞
尚秦翼
邵鹏斐
沈丽君
沈思成
盛鑫豪
施琴
石海吟
石怀玉
石金桥
石灵
石璐
石庆界
石小雨
石迎港
史飞
史勤
舒进
舒萌
舒泳
帅皓钦
帅婧
帅紫琪
斯慧慧
斯慧群
宋富源
宋家豪
宋坤
宋坤蓉 
宋日健
宋巍
宋瑶函
宋雨杭
宋雨嫣
苏晋蓉
苏文健
孙蓓佳
孙焕森
孙金昊
孙凯
孙磊
孙璐
孙蒙
孙若男
孙婉琪
孙炜玥
孙曦
孙新宇
孙学艺
孙雪锐
孙樱溪
孙宇辰
孙宇鹏
孙钰寒
孙玥
台婷婷
覃安荣
覃飞洋
覃元瑞
覃宗乐
谭鸿文
谭诗筱
谭淑红
谭婷
谭秀琳
谭喻尹
谭智力
汤涛
唐博
唐超懿
唐冬旭
唐伏蓉
唐付静
唐国琼
唐汉雄
唐教素
唐婧
唐藜予
唐里
唐铭
唐琪
唐倩
唐思琪
唐涛
唐天宝
唐田甜
唐雯
唐翌凌
唐于迪
唐钰尧
唐媛媛
唐韵
唐知宇
陶敬源
陶晓峰
陶颖
陶永勇
陶稚玲
陶忠庆
田碧清
田波
田靖
田其文
田青
田园
田正梅
田子坤
田紫晗
童李洁
涂凯
涂祥策
万庚城
万倩茹
万昱呈
汪益民
王阿靓
王蓓
王彬莲
王冰
王博毅
王彩云
王彩云
王琛迪
王陈晨
王代富
王菲平
王光燕
王郭
王海平
王海燕
王含
王鹤
王鹤蓉
王红叶
王洪伟
王珲
王健
王江
王锦秋
王静宜
王玖斌
王涓郦
王俊霖
王俊霖
王骏晨
王骊珠
王礼耕
王丽萍
王凌艳
王路标
王璐
王璐
王珞蔚
王曼
王明洋
王牧文
王宁
王琦
王倩倩
王秋雯
王锐
王瑞铮
王润冲
王若曦
王少敏
王姝媛
王思卿
王泰民
王堂宇
王堂宇 
王涛
王天旭
王铁帅
王亭颖
王亭颖 
王韦
王蔚宇
王文璟
王文婧
王雯麒
王武
王宪振
王潇
王小军
王小雅
王晓
王晓笑
王昕航
王馨艺
王鑫
王诩
王雪
王亚南
王彦如
王艳
王业億
王一存 
王一鸣
王怡欣
王意
王寅羽
王瑛
王盈
王永鑫
王宇
王羽
王雨琪
王禹程
王钰皓 
王泽川
王钊
王志敏
王志贤
王致远
王智慧
王卓然
王子恒
王子琪
王子璇
王祚
旺吉扎西
韦浪
韦伊
韦宇宁
韦云潇
魏国运
魏珏
魏琦
魏倩茹
魏文恒
温雪
文波 
文浩宇
文惠
文琳
文星皓
文雅苹
文忠于
邬蒙
巫英清
毋忧
吴贝纤
吴冰心子
吴棣
吴晗曦
吴昊天
吴佳丽
吴柳蓉
吴柳蓉
吴孟亭
吴倩云
吴瑞恩
吴姝果
吴双舟
吴天若
吴婷
吴幸蔚
吴旭
吴一可
吴一鹭
吴宇
吴宇娇
吴宇亮
吴宇璇
吴羽佳
吴雨航
吴雨桐
吴玉婷
吴智一
吴紫怡
伍依玫
武尚晋
奚麦涵
席蔚
夏邦林
夏邦于
夏宁馨
夏怡楷
夏雨
夏运嘉
先巧琳 
鲜佩君
向海栗
向佳
向敏
向希培
向玺滢
向杨
肖丹青
肖国燕
肖嘉琪
肖精霞
肖鹏翔
肖婷徽
肖文
肖娅佳
肖瑶
谢东旭
谢国力
谢柳芳
谢巧
谢巧
谢庆红
谢莎
谢枭
谢枭
谢永鑫
谢宇晖
谢雨晴
谢元正
谢玥
谢瞻
谢振榕
谢卓宏
邢亮
邢榕
邢杨超
熊辩
熊佳露
熊林蔓
熊芯卉
熊雪颖
熊旖旎
熊远志
徐白斌
徐曹睿
徐辰茹
徐晨航
徐怀富
徐欢
徐慧
徐晋
徐平和
徐玉虎
徐悦萍
许东杰
许芳涔
许光蓉
许鸿雁
许文华
许雨洁
薛凤娇
薛晶洁
薛宁东
薛杉
薛宛彤
薛雅心
薛志红
雪松
闫莉香
闫雅婕
闫怡璇
严晨嘉
严崇人
严兢菁
严静诗
严颖
阎思充
颜婷玉
阳春
阳浩
阳涛
杨安琪
杨曾
杨辰光
杨冬培
杨飞
杨飞萍
杨霏
杨富鹏
杨馥铭
杨光
杨海艳
杨海艳
杨浩然
杨竑敏
杨惠
杨济如
杨晶
杨婧
杨婧怡
杨娟
杨可歆
杨李琦
杨丽嘉
杨玲
杨柳
杨龙杰
杨璐
杨蒙蒙
杨敏
杨沐然
杨娜
杨乔莉
杨琼
杨蕊菱
杨锐
杨申杰
杨诗佳
杨舒婷
杨曙箕
杨双
杨烁
杨思睿
杨斯敬
杨天乐
杨婷
杨婷婷
杨文
杨夏
杨鑫
杨雅涵
杨一珩
杨宇
杨雨东
杨禹帆
杨钰婕
杨裕秋
杨韵可
杨兆旭
杨梓嫣
姚灿
姚丞彧
姚鸾
姚扬
姚永富
姚瑜
姚元红
冶秀娟
叶婧
叶敏
叶鹏科
叶思琦
叶心宇
叶旭彤
叶怡恬
叶又豪
叶子一
易鹤林
易嘉鸣
殷钧迅
殷昕霞
殷星雨
殷源
尹昌列
尹露涓
尹玮
尹翔毅
应洪镛
应思成
雍蔼媛
游频捷
于强
于强强
于松柏
于涛
于小超
于晓谦
余冰颖
余佳荫
余嘉琦
余洁
余诗韫
余彦
余子谦
虞晓卫
宇文蕙兰
元远
袁梦
袁梦圆
袁明东
袁琦
袁洋
袁洋
袁怡昕
袁蕴
袁真怡
原沐滋
原紫娇
岳国清
岳亚男
岳毅仁
昝方媛
詹婷
张波
张策维
张程
张驰晨
张狄龙
张迪
张光奇
张海彬
张瀚文
张浩
张浩辉
张皓
张红兵
张红明
张鸿良
张焕城
张继元
张佳宇
张家治
张姣
张杰
张洁菁
张锦慧
张锦江
张晋豪
张婧文
张婧晔
张珺瑶
张凯然
张科理
张磊
张力
张立光
张丽
张亮
张琳
张玲
张柳
张龙
张萌
张梦舒
张梦舒
张敏
张鸣乾
张楠
张淇琳
张琪
张仟又
张强
张清雅
张然
张镕
张锐喆
张姗姗
张诗琪
张舒
张舒越
张爽
张斯琦
张天
张婷
张婷睿
张婷婷
张文蓉
张雯鑫
张舷
张小鹏
张晓彤
张晓香
张笑伊
张昕敏
张鑫崴
张学莹
张雅岚
张严
张杨雪
张洋
张瑶
张一唯
张怡
张艺蓝
张易
张益铭
张意茹
张毅
张翼凌
张颖
张勇
张宇晨
张宇豪
张玉
张玉玲
张煜萱
张钺
张哲栋
张喆
张振亚
张振宇
张正元
赵红梅
赵会才
赵佳乐
赵建义
赵晶
赵婧
赵莉娟
赵孟涵
赵敏
赵埔兴
赵骞
赵茜
赵倩
赵珊
赵思敏
赵文燕
赵小雨
赵晓敏
赵星雨
赵一凡
赵乙人
赵毅成
赵悦吟
赵舟宇
郑冰晶
郑军
郑军
郑俊茹
郑廉荣
郑亮
郑淋心
郑敏豪
郑茜
郑倩
郑倩雯
郑钦月
郑无为
郑晓楠
郑叶帆
郑翌佳
郑志强
支璇
钟杰松
钟洁
钟琦琦
钟文举
钟雯萱
钟雨荷
仲秋瑶
周本娇
周冰
周楚皓
周丹
周宏宇
周劼兮
周杰
周洁
周洁
周俊炜
周力豪
周伶俐
周明月
周沐雨
周琪
周琴
周仁秀
周午强
周夕雅
周先遥
周晓
周新黎
周鑫
周星妤
周星宇
周璇
周雪
周雅菲
周雅兰
周杨
周益
周盈盈
周玉凌
周圆
周媛
周子豪
朱策
朱冠宇
朱劲涛
朱俊英
朱蕾
朱琳
朱梦涛
朱敏之
朱泉灵
朱思凝
朱思远
朱馨予
朱嫣
朱玉莲
朱玉婷
朱钰坪
朱元宏
朱梓菡
朱宗美
祝春雪
祝宇昊
祝语
庄秀坤
卓治鑫
邹佳悦
邹雨贝
邹雨宏
左良
左名皓
左诗雨
左雪瑶
左乂丹
`,

            // 性能优化配置
            batchSize: 1000,                             // 批处理大小
            processingDelay: 10,                         // 批处理间隔(毫秒)
            maxLoadTime: 30000                           // 最大加载时间(毫秒)
        };
        
        let alumniList = []; // 校友名单
        let claimedList = {}; // 已领取记录
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 使用全局变量存储计时器
            window.resultTimer = null;
            
            if (CONFIG.useGitHubCSV) {
                loadAlumniFromGitHub();
            } else {
                loadEmbeddedCSV();
            }
            
            if (CONFIG.useCloudSync && CONFIG.jsonbinApiKey && CONFIG.jsonbinBinId) {
                loadClaimedFromCloud();
            } else {
                loadClaimedFromLocal();
                if (!CONFIG.jsonbinApiKey || !CONFIG.jsonbinBinId) {
                    showSyncStatus('未配置云同步，使用本地模式');
                }
            }
        });
        
        // 从GitHub加载校友名单
        async function loadAlumniFromGitHub() {
            try {
                showLoading('正在从GitHub加载校友名单...');
                
                const url = `https://raw.githubusercontent.com/${CONFIG.githubUser}/${CONFIG.repoName}/main/${CONFIG.csvFileName}`;
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: 无法找到CSV文件`);
                }
                
                const csvText = await response.text();
                
                if (!csvText.trim()) {
                    throw new Error('CSV文件为空');
                }
                
                // 使用优化后的CSV解析
                parseCSV(csvText);
                
            } catch (error) {
                console.error('从GitHub加载校友名单失败:', error);
                showError(`GitHub加载失败: ${error.message}`);
                
                // 降级到内嵌数据
                showLoading('使用备用校友名单...');
                setTimeout(() => {
                    loadEmbeddedCSV();
                }, 1000);
            }
        }
        
        // 加载内嵌CSV
        function loadEmbeddedCSV() {
            try {
                showLoading('正在加载备用校友名单...');
                parseCSV(CONFIG.embeddedCSV);
            } catch (error) {
                console.error('加载内嵌CSV失败:', error);
                showError('校友名单加载失败: ' + error.message);
                hideLoading();
            }
        }
        
        // 从云端加载已领取记录
        async function loadClaimedFromCloud() {
            try {
                showLoading('正在同步领取记录...');
                
                const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.jsonbinBinId}/latest`, {
                    headers: {
                        'X-Master-Key': CONFIG.jsonbinApiKey
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    claimedList = data.record || {};
                    showSyncStatus('数据已同步 ✅');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.warn('云端同步失败，使用本地数据:', error);
                loadClaimedFromLocal();
                showSyncStatus('云同步失败，使用本地模式');
            }
            
            hideLoading();
            enableInput();
            updateStats();
        }
        
        // 从本地加载已领取记录
        function loadClaimedFromLocal() {
            const stored = localStorage.getItem('claimedList');
            claimedList = stored ? JSON.parse(stored) : {};
        }
        
        // 保存已领取记录到云端
        async function saveClaimedToCloud() {
            if (!CONFIG.useCloudSync || !CONFIG.jsonbinApiKey || !CONFIG.jsonbinBinId) {
                saveClaimedToLocal();
                return;
            }
            
            try {
                showLoading('正在同步到云端...');
                
                const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.jsonbinBinId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': CONFIG.jsonbinApiKey
                    },
                    body: JSON.stringify(claimedList)
                });
                
                if (response.ok) {
                    hideLoading();
                    showSyncStatus('数据已全球同步 ✅');
                    
                    // 额外确认数据已成功同步
                    verifyCloudSync();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.warn('云端保存失败，保存到本地:', error);
                saveClaimedToLocal();
                hideLoading();
                showSyncStatus('云同步失败，已保存到本地');
            }
        }
        
        // 验证云端同步是否成功
        async function verifyCloudSync() {
            try {
                // 短暂延迟确保数据已写入
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.jsonbinBinId}/latest`, {
                    headers: {
                        'X-Master-Key': CONFIG.jsonbinApiKey
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // 检查云端数据是否与本地一致
                    const cloudKeys = Object.keys(data.record || {}).length;
                    const localKeys = Object.keys(claimedList).length;
                    
                    if (cloudKeys !== localKeys) {
                        console.warn(`云端数据与本地不一致！云端: ${cloudKeys}, 本地: ${localKeys}`);
                        // 再次尝试同步
                        await forceSyncToCloud();
                    }
                }
            } catch (error) {
                console.warn('验证云端同步失败:', error);
            }
        }
        
        // 强制同步到云端（用于重置后）
        async function forceSyncToCloud() {
            try {
                console.log('强制同步到云端...');
                
                const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.jsonbinBinId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': CONFIG.jsonbinApiKey,
                        'X-Bin-Versioning': 'false' // 禁用版本控制，强制覆盖
                    },
                    body: JSON.stringify(claimedList)
                });
                
                if (response.ok) {
                    console.log('强制同步成功');
                    showSyncStatus('数据已强制同步 ✅');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('强制同步失败:', error);
            }
        }
        
        // 保存到本地
        function saveClaimedToLocal() {
            localStorage.setItem('claimedList', JSON.stringify(claimedList));
        }
        
        // 解析CSV
        function parseCSV(csvText) {
            showLoading('正在处理校友名单...');
            
            // 使用延迟处理以避免阻塞UI
            setTimeout(() => {
                try {
                    const lines = csvText.split('\n').filter(line => line.trim());
                    const names = [];
                    
                    // 进度指示变量
                    const totalLines = lines.length;
                    const updateInterval = Math.max(1, Math.floor(totalLines / 10)); // 更新10次进度
                    
                    // 分批处理大型CSV以避免UI冻结
                    processLinesInBatches(lines, 0, 1000, names, totalLines, updateInterval);
                    
                } catch (error) {
                    console.error('处理CSV时出错:', error);
                    showError('CSV处理错误: ' + error.message);
                    hideLoading();
                    
                    // 尝试加载备用数据
                    if (CONFIG.embeddedCSV && csvText !== CONFIG.embeddedCSV) {
                        setTimeout(() => {
                            loadEmbeddedCSV();
                        }, 1000);
                    }
                }
            }, 100);
        }
        
        // 分批处理CSV行
        function processLinesInBatches(lines, startIndex, batchSize, names, totalLines, updateInterval) {
            const endIndex = Math.min(startIndex + batchSize, lines.length);
            
            for (let i = startIndex; i < endIndex; i++) {
                const line = lines[i];
                const columns = line.split(',');
                const name = columns[0] ? columns[0].trim().replace(/"/g, '') : '';
                
                if (name && name !== '姓名' && name !== 'name' && name !== '名字' && !name.includes('请在这里添加')) {
                    names.push({
                        id: `${name}_${i}`,
                        name: name,
                        originalIndex: i
                    });
                }
                
                // 更新处理进度
                if (i % updateInterval === 0) {
                    const progress = Math.floor((i / totalLines) * 100);
                    document.getElementById('loadingText').textContent = `正在处理校友名单... ${progress}%`;
                }
            }
            
            if (endIndex < lines.length) {
                // 还有更多行要处理，安排下一批
                setTimeout(() => {
                    processLinesInBatches(lines, endIndex, batchSize, names, totalLines, updateInterval);
                }, 0);
            } else {
                // 所有行都已处理完毕
                finishCSVProcessing(names);
            }
        }
        
        // 完成CSV处理
        function finishCSVProcessing(names) {
            if (names.length === 0) {
                showError('CSV文件中没有找到有效的姓名数据');
                hideLoading();
                return;
            }
            
            // 构建姓名索引以加快搜索
            alumniList = names;
            buildNameIndex(names);
            
            hideLoading();
            showSuccess(`成功加载 ${alumniList.length} 位校友信息`);
            enableInput();
            updateStats();
        }
        
        // 构建姓名索引以加快搜索
        let nameIndex = {};
        function buildNameIndex(names) {
            nameIndex = {};
            for (let i = 0; i < names.length; i++) {
                const name = names[i].name;
                if (!nameIndex[name]) {
                    nameIndex[name] = [];
                }
                nameIndex[name].push(i);
            }
        }
        
        // 显示加载状态
        function showLoading(message) {
            document.getElementById('loadingText').textContent = message;
            document.getElementById('loadingContainer').classList.remove('hidden');
            document.getElementById('errorMessage').classList.add('hidden');
            document.getElementById('successMessage').classList.add('hidden');
            
            // 禁用输入框和查询按钮
            document.getElementById('nameInput').disabled = true;
            document.getElementById('checkBtn').disabled = true;
        }
        
        // 隐藏加载状态
        function hideLoading() {
            document.getElementById('loadingContainer').classList.add('hidden');
        }
        
        // 显示同步状态
        function showSyncStatus(message) {
            document.getElementById('syncStatus').textContent = message;
            document.getElementById('syncStatus').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('syncStatus').classList.add('hidden');
            }, 3000);
        }
        
        // 显示错误信息
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorMessage').classList.remove('hidden');
            document.getElementById('successMessage').classList.add('hidden');
        }
        
        // 显示成功信息
        function showSuccess(message) {
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successMessage').classList.remove('hidden');
            document.getElementById('errorMessage').classList.add('hidden');
            
            setTimeout(() => {
                document.getElementById('successMessage').classList.add('hidden');
            }, 3000);
        }
        
        // 启用输入功能
        function enableInput() {
            document.getElementById('nameInput').disabled = false;
            document.getElementById('checkBtn').disabled = false;
        }
        
        // 检查姓名
        function checkName() {
            const nameInput = document.getElementById('nameInput');
            const name = nameInput.value.trim();
            
            if (!name) {
                showResult('请输入您的姓名！', 'not-found');
                return;
            }
            
            // 使用索引快速查找，而不是过滤整个数组
            if (nameIndex[name]) {
                const indices = nameIndex[name];
                const matchedAlumni = indices.map(index => alumniList[index]);
                
                if (matchedAlumni.length === 1) {
                    handleSingleMatch(matchedAlumni[0]);
                } else {
                    showDuplicateOptions(matchedAlumni);
                }
            } else {
                showResult(`抱歉，未找到 "${name}" 的校友信息\n您的名字不在会计校友数据库内，请找工作人员处理`, 'not-found');
                hideDuplicateOptions();
            }
        }
        
        // 处理单个匹配
        function handleSingleMatch(alumni) {
            if (!alumni) {
                showResult(`系统错误，请重试`, 'not-found');
                return;
            }
            
            if (claimedList[alumni.id]) {
                showResult(`${alumni.name} - 您已经领取过礼品了 ✅`, 'taken');
            } else {
                claimGift(alumni);
            }
            hideDuplicateOptions();
        }
        
        // 显示重名选择项
        function showDuplicateOptions(matchedAlumni) {
            const duplicateOptions = document.getElementById('duplicateOptions');
            const duplicateList = document.getElementById('duplicateList');
            
            duplicateList.innerHTML = '';
            
            matchedAlumni.forEach((alumni, index) => {
                const item = document.createElement('div');
                item.className = 'duplicate-item';
                
                const isClaimed = claimedList[alumni.id];
                const status = isClaimed ? '已领取' : '可领取';
                const statusClass = isClaimed ? 'status-taken' : 'status-available';
                
                item.innerHTML = `
                    <div>
                        <span class="duplicate-name">${alumni.name} #${index + 1}</span>
                        <span class="duplicate-status ${statusClass}">${status}</span>
                    </div>
                    <button class="duplicate-btn" 
                            onclick="selectAlumni('${alumni.id}')" 
                            ${isClaimed ? 'disabled' : ''}>
                        ${isClaimed ? '已领取' : '选择此项'}
                    </button>
                `;
                
                duplicateList.appendChild(item);
            });
            
            duplicateOptions.style.display = 'block';
            hideResult();
        }
        
        // 隐藏重名选择项
        function hideDuplicateOptions() {
            document.getElementById('duplicateOptions').style.display = 'none';
        }
        
        // 选择特定校友
        function selectAlumni(alumniId) {
            const alumni = alumniList.find(a => a.id === alumniId);
            if (alumni) {
                claimGift(alumni);
                hideDuplicateOptions();
            }
        }
        
        // 领取礼品
        async function claimGift(alumni) {
            showLoading('正在处理领取...');
            
            claimedList[alumni.id] = {
                name: alumni.name,
                timestamp: new Date().toISOString(),
                date: new Date().toISOString().split('T')[0]
            };
            
            await saveClaimedToCloud();
            
            hideLoading();
            updateStats();
            showResult(`恭喜 ${alumni.name}！礼品领取成功 🎉`, 'available');
            
            document.getElementById('nameInput').value = '';
        }
        
        // 刷新数据
        async function refreshData() {
            if (CONFIG.useCloudSync && CONFIG.jsonbinApiKey && CONFIG.jsonbinBinId) {
                await loadClaimedFromCloud();
            } else {
                loadClaimedFromLocal();
                updateStats();
                showSyncStatus('本地数据已刷新');
            }
        }
        
        // 显示结果
        function showResult(message, type) {
            const result = document.getElementById('result');
            result.textContent = message;
            result.className = `result ${type}`;
            
            // 显示结果
            result.classList.add('show');
            
            // 设置120秒后自动消失
            clearTimeout(window.resultTimer); // 清除之前的计时器
            window.resultTimer = setTimeout(() => {
                result.classList.remove('show');
            }, 120000); // 120秒 = 2分钟
        }
        
        // 隐藏结果
        function hideResult() {
            const result = document.getElementById('result');
            result.classList.remove('show');
            clearTimeout(window.resultTimer);
        }
        
        // 更新统计
        function updateStats() {
            const claimedCount = Object.keys(claimedList).length;
            document.getElementById('claimedCount').textContent = claimedCount;
        }
        
        // 显示JSONBin管理信息
        function showJsonBinInfo() {
            if (!CONFIG.useCloudSync || !CONFIG.jsonbinApiKey || !CONFIG.jsonbinBinId) {
                showResult('未配置云同步功能', 'not-found');
                return;
            }
            
            // 显示管理提示
            const message = `
                <div style="text-align:left; font-size:14px; line-height:1.5">
                    <p><strong>JSONBin云端数据管理指南</strong></p>
                    <p>您可以直接访问JSONBin管理界面重置或修改数据：</p>
                    <ol style="margin-left:20px">
                        <li>访问 <a href="https://jsonbin.io/app/bins" target="_blank">https://jsonbin.io/app/bins</a></li>
                        <li>使用您的账号登录</li>
                        <li>找到ID为 <code>${CONFIG.jsonbinBinId}</code> 的数据</li>
                        <li>点击"Edit"可以编辑，清空内容后替换为 <code>{}</code> 即可重置</li>
                    </ol>
                    <p><small>注意：请谨慎操作，数据修改后将影响所有使用该系统的用户</small></p>
                </div>`;
            
            // 创建模态框
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.right = '0';
            modal.style.bottom = '0';
            modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
            modal.style.display = 'flex';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
            modal.style.zIndex = '1000';
            
            const modalContent = document.createElement('div');
            modalContent.style.backgroundColor = 'white';
            modalContent.style.padding = '20px';
            modalContent.style.borderRadius = '10px';
            modalContent.style.maxWidth = '90%';
            modalContent.style.width = '400px';
            modalContent.style.maxHeight = '80vh';
            modalContent.style.overflowY = 'auto';
            modalContent.innerHTML = message;
            
            const closeButton = document.createElement('button');
            closeButton.textContent = '关闭';
            closeButton.style.marginTop = '15px';
            closeButton.style.padding = '8px 15px';
            closeButton.style.backgroundColor = '#002FA7'; /* 克莱因蓝 */
            closeButton.style.color = 'white';
            closeButton.style.border = 'none';
            closeButton.style.borderRadius = '5px';
            closeButton.style.cursor = 'pointer';
            closeButton.onclick = function() {
                document.body.removeChild(modal);
            };
            
            modalContent.appendChild(closeButton);
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // 点击模态框背景关闭
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }
        
        // 导出数据
        function exportData() {
            // 自定义密码输入框而不是使用prompt
            hideResult(); // 先隐藏当前结果
            
            // 创建模态框
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.right = '0';
            modal.style.bottom = '0';
            modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
            modal.style.display = 'flex';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
            modal.style.zIndex = '1000';
            
            const modalContent = document.createElement('div');
            modalContent.style.backgroundColor = 'white';
            modalContent.style.padding = '20px';
            modalContent.style.borderRadius = '10px';
            modalContent.style.maxWidth = '90%';
            modalContent.style.width = '300px';
            modalContent.innerHTML = `
                <h3 style="margin-top:0;color:#333;margin-bottom:15px;">请输入导出密码</h3>
                <input type="password" id="exportPassword" style="width:100%;padding:8px;margin-bottom:15px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box;" placeholder="请输入密码...">
                <div style="display:flex;justify-content:flex-end;gap:10px;">
                    <button id="cancelExport" style="padding:8px 15px;background:#f8f9fa;border:1px solid #ddd;border-radius:4px;cursor:pointer;">取消</button>
                    <button id="confirmExport" style="padding:8px 15px;background:#002FA7;color:white;border:none;border-radius:4px;cursor:pointer;">确认</button>
                </div>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // 获取输入框焦点
            setTimeout(() => {
                document.getElementById('exportPassword').focus();
            }, 100);
            
            // 取消按钮
            document.getElementById('cancelExport').addEventListener('click', function() {
                document.body.removeChild(modal);
            });
            
            // 点击背景关闭
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
            
            // 密码输入框回车支持
            document.getElementById('exportPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('confirmExport').click();
                }
            });
            
            // 确认按钮
            document.getElementById('confirmExport').addEventListener('click', function() {
                const password = document.getElementById('exportPassword').value;
                document.body.removeChild(modal);
                
                // 检查密码
                if (password !== 'xy2025') {
                    showResult('密码错误，无法导出记录', 'not-found');
                    return;
                }
                
                proceedWithExport();
            });
        }
        
        // 执行导出操作
        function proceedWithExport() {
            if (Object.keys(claimedList).length === 0) {
                showResult('暂无领取记录可导出', 'not-found');
                return;
            }
            
            const records = Object.values(claimedList).map(record => {
                return `${record.name},${record.timestamp}`;
            });
            
            const csvContent = '姓名,领取时间\n' + records.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `领取记录_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showResult('领取记录导出成功！', 'available');
        }
        
        // 回车键和按钮点击支持
        document.getElementById('nameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkName();
            }
        });
        
        document.getElementById('checkBtn').addEventListener('click', function() {
            checkName();
        });
        
        // 防止页面缩放
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });
        
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
